<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Architecture | Trade Order Feature</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral Harmony -->
    <!-- Application Structure Plan: A single-page, top-to-bottom scrolling layout. The structure is thematic, following the source document's flow: Principles -> Services -> Data Flow -> Schema. This linear narrative is the most effective way to present a technical architecture document, guiding the user from high-level concepts to detailed implementation specifics in a logical progression. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Core Principles -> Goal: Inform -> Viz: Styled HTML Cards -> Interaction: Static -> Justification: Clearly presents the three architectural pillars. Method: HTML/CSS.
        - Report Info: Key Services -> Goal: Organize -> Viz: Grid of Cards -> Interaction: Static -> Justification: Each service is a self-contained unit, making a card-based layout intuitive for separating concerns. Method: HTML/CSS.
        - Report Info: Data Flow Diagram -> Goal: Show Process -> Viz: HTML/CSS Diagram -> Interaction: Static -> Justification: Translates the text-based diagram into a clear visual flow, which is crucial for understanding service interactions. Method: HTML/CSS.
        - Report Info: Database Schema -> Goal: Organize -> Viz: Styled HTML Tables -> Interaction: Static -> Justification: A table is the standard and most effective way to represent a database schema. Method: HTML/CSS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8F9FA; }
        .arrow-head {
            position: absolute;
            border-style: solid;
            border-color: transparent;
            content: '';
            border-width: 6px;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-6xl">

        <header class="text-center my-8 md:my-12">
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900 tracking-tight">
                Technical Architecture for the Trade Order Feature
            </h1>
        </header>
        <section id="principles" class="my-12">
            <h2 class="text-2xl font-bold text-center mb-8">Core Architectural Principles</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">Microservices</h3>
                    <p class="mt-2 text-gray-600">The system is broken down into small, independent services, each with a single responsibility. This allows for independent development, deployment, and scaling.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">Asynchronous Communication</h3>
                    <p class="mt-2 text-gray-600">Services communicate via a message queue (like RabbitMQ or Kafka). This decouples the services, ensuring high availability and data integrity under heavy load.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">Real-Time Updates</h3>
                    <p class="mt-2 text-gray-600">A dedicated real-time service uses WebSockets to push live updates to the user interface, ensuring Pilots see new orders instantly without needing to refresh.</p>
                </div>
            </div>
        </section>

        <section id="services" class="my-16">
            <h2 class="text-2xl font-bold text-center mb-8">Key Services & Their Roles</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- API Gateway -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">1. API Gateway</h3>
                </div>
                <!-- Order Service -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">2. Order Service</h3>
                    <div class="mt-3 text-xs font-mono bg-gray-100 p-2 rounded">
                        <p>POST /orders</p>
                        <p>PUT /orders/{id}/publish</p>
                    </div>
                </div>
                <!-- Scheduler Service -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">3. Scheduler Service</h3>
                </div>
                <!-- Real-Time Service -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">4. Real-Time Service</h3>
                </div>
                <!-- Trade Copy Service -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">5. Trade Copy Service</h3>
                     <div class="mt-3 text-xs font-mono bg-gray-100 p-2 rounded">
                        <p>POST /copy-trades</p>
                    </div>
                </div>
                <!-- Brokerage Service -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <h3 class="font-bold text-lg text-gray-900">6. Brokerage Service</h3>
                </div>
            </div>
        </section>

        <section id="data-flow" class="my-16">
            <h2 class="text-2xl font-bold text-center mb-8">Data Flow: Lifecycle of a Trade Order</h2>
            <div class="relative w-full mx-auto" style="height: 1200px;">
                <img src="data-flow-diagram.png" alt="Data Flow Diagram" class="w-full h-full object-contain">
            </div>
            <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-6">Step-by-Step Data Flow</h3>
                <div class="space-y-4">
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">1</div>
                        <p class="text-gray-700"><span class="font-medium text-blue-600">Navigator UI</span> connects to the <span class="font-medium text-green-600">API Gateway</span> to send requests for creating or publishing a trade order.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">2</div>
                        <p class="text-gray-700">The <span class="font-medium text-green-600">API Gateway</span> then routes these requests to the <span class="font-medium text-purple-600">Order Service</span>.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">3</div>
                        <p class="text-gray-700">The <span class="font-medium text-purple-600">Order Service</span> connects to the <span class="font-medium text-gray-600">Database</span> to save and update the order's information.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">4</div>
                        <p class="text-gray-700">The <span class="font-medium text-orange-600">Scheduler Service</span> also connects to the <span class="font-medium text-purple-600">Order Service</span> to trigger the publication of scheduled orders.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">5</div>
                        <p class="text-gray-700">When an order is published, the <span class="font-medium text-purple-600">Order Service</span> sends an event to the <span class="font-medium text-yellow-600">Message Queue</span>.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">6</div>
                        <p class="text-gray-700">The <span class="font-medium text-indigo-600">Real-Time Service</span> listens to the <span class="font-medium text-yellow-600">Message Queue</span> and picks up the new order event.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">7</div>
                        <p class="text-gray-700">The <span class="font-medium text-indigo-600">Real-Time Service</span> then pushes the update via a WebSocket to the <span class="font-medium text-red-600">Pilot UI</span>.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">8</div>
                        <p class="text-gray-700">When a pilot decides to follow a trade, the <span class="font-medium text-red-600">Pilot UI</span> sends a request back to the <span class="font-medium text-green-600">API Gateway</span>.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">9</div>
                        <p class="text-gray-700">The <span class="font-medium text-green-600">API Gateway</span> routes this "follow" request to the <span class="font-medium text-pink-600">Trade Copy Service</span>.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">10</div>
                        <p class="text-gray-700">The <span class="font-medium text-pink-600">Trade Copy Service</span> processes the request and sends an execution command to the <span class="font-medium text-emerald-600">Brokerage Service</span>.</p>
                    </div>
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-sm font-medium">11</div>
                        <p class="text-gray-700">Finally, the <span class="font-medium text-emerald-600">Brokerage Service</span> connects to the external <span class="font-medium text-slate-600">Broker API</span> to place the trade in the pilot's account.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="schema" class="my-16">
            <h2 class="text-2xl font-bold text-center mb-8">Detailed Database Schema</h2>
            <div class="space-y-12">
                <!-- Users Table -->
                <div>
                    <h3 class="font-semibold text-lg mb-2">Users Table</h3>
                    <div class="overflow-x-auto bg-white rounded-lg shadow-sm border">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50"><tr class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <th class="px-6 py-3">Column</th><th class="px-6 py-3">Type</th><th class="px-6 py-3">Description</th>
                            </tr></thead>
                            <tbody class="divide-y divide-gray-200 text-sm">
                                <tr><td class="px-6 py-4 font-mono">user_id</td><td class="px-6 py-4 font-mono">UUID</td><td class="px-6 py-4">Primary Key.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">email</td><td class="px-6 py-4 font-mono">VARCHAR(255)</td><td class="px-6 py-4">User's unique email address.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">role</td><td class="px-6 py-4 font-mono">ENUM</td><td class="px-6 py-4">'Navigator' or 'Pilot'.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Subscriptions Table -->
                <div>
                    <h3 class="font-semibold text-lg mb-2">Subscriptions Table</h3>
                    <div class="overflow-x-auto bg-white rounded-lg shadow-sm border">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50"><tr class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <th class="px-6 py-3">Column</th><th class="px-6 py-3">Type</th><th class="px-6 py-3">Description</th>
                            </tr></thead>
                            <tbody class="divide-y divide-gray-200 text-sm">
                                <tr><td class="px-6 py-4 font-mono">subscription_id</td><td class="px-6 py-4 font-mono">UUID</td><td class="px-6 py-4">Primary Key.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">pilot_id</td><td class="px-6 py-4 font-mono">UUID</td><td class="px-6 py-4">Foreign Key to Users.user_id.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">navigator_id</td><td class="px-6 py-4 font-mono">UUID</td><td class="px-6 py-4">Foreign Key to Users.user_id.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- Orders Table -->
                <div>
                    <h3 class="font-semibold text-lg mb-2">Orders Table</h3>
                    <div class="overflow-x-auto bg-white rounded-lg shadow-sm border">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50"><tr class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <th class="px-6 py-3">Column</th><th class="px-6 py-3">Type</th><th class="px-6 py-3">Description</th>
                            </tr></thead>
                            <tbody class="divide-y divide-gray-200 text-sm">
                                <tr><td class="px-6 py-4 font-mono">order_id</td><td class="px-6 py-4 font-mono">UUID</td><td class="px-6 py-4">Primary Key.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">navigator_id</td><td class="px-6 py-4 font-mono">UUID</td><td class="px-6 py-4">Foreign Key to Users.user_id.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">status</td><td class="px-6 py-4 font-mono">ENUM</td><td class="px-6 py-4">'Private', 'Published', 'Deleted', 'Expired'.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">order_type</td><td class="px-6 py-4 font-mono">VARCHAR(50)</td><td class="px-6 py-4">e.g., 'MARKET', 'LIMIT', 'STOP LIMIT'.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">tif</td><td class="px-6 py-4 font-mono">VARCHAR(50)</td><td class="px-6 py-4">Time in Force (e.g., 'Day', 'GTC').</td></tr>
                                <tr><td class="px-6 py-4 font-mono">release_time</td><td class="px-6 py-4 font-mono">TIMESTAMP</td><td class="px-6 py-4">Scheduled time for auto-publishing.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                 <!-- CopiedTrades Table -->
                <div>
                    <h3 class="font-semibold text-lg mb-2">CopiedTrades Table</h3>
                    <div class="overflow-x-auto bg-white rounded-lg shadow-sm border">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50"><tr class="text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                <th class="px-6 py-3">Column</th><th class="px-6 py-3">Type</th><th class="px-6 py-3">Description</th>
                            </tr></thead>
                            <tbody class="divide-y divide-gray-200 text-sm">
                                <tr><td class="px-6 py-4 font-mono">copied_trade_id</td><td class="px-6 py-4 font-mono">UUID</td><td class="px-6 py-4">Primary Key.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">original_order_id</td><td class="px-6 py-4 font-mono">UUID</td><td class="px-6 py-4">Foreign Key to Orders.order_id.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">pilot_id</td><td class="px-6 py-4 font-mono">UUID</td><td class="px-6 py-4">Foreign Key to Users.user_id.</td></tr>
                                <tr><td class="px-6 py-4 font-mono">status</td><td class="px-6 py-4 font-mono">ENUM</td><td class="px-6 py-4">'Pending', 'Executed', 'Failed'.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

    </div>
</body>
</html>
